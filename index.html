<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
<title>PRISM ‚Äî Live TV</title>
<link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Barlow:ital,wght@0,300;0,400;0,600;1,300&display=swap" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/shaka-player/4.7.11/shaka-player.compiled.min.js"></script>
<style>
  /* ‚ïê‚ïê VARIABLES ‚ïê‚ïê */
  :root {
    --bg:     #f0f5f1;
    --surf:   #ffffff;
    --surf2:  #e6f0e8;
    --bdr:    #bdd4c2;
    --acc:    #1a8c35;
    --acc2:   #d42b2b;
    --acc3:   #c47a00;
    --acc4:   #0e7a63;
    --txt:    #172a1c;
    --muted:  #537a5c;
    --lbl:    #2a5e38;
    --grid:   rgba(26,140,53,0.05);
    --inp:    #ffffff;
    --shadow: rgba(0,0,0,0.07);
    --glow:   rgba(26,140,53,0.12);
  }

  /* ‚ïê‚ïê RESET ‚ïê‚ïê */
  *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
  html { -webkit-text-size-adjust: 100%; scroll-behavior: smooth; }
  body {
    background: var(--bg); color: var(--txt);
    font-family: 'Barlow', sans-serif; font-weight: 300;
    min-height: 100vh; overflow-x: hidden;
    -webkit-font-smoothing: antialiased;
  }
  body::before {
    content: ''; position: fixed; inset: 0; z-index: 0; pointer-events: none;
    background-image: linear-gradient(var(--grid) 1px,transparent 1px),
                      linear-gradient(90deg,var(--grid) 1px,transparent 1px);
    background-size: 36px 36px;
  }

  /* ‚ïê‚ïê HEADER ‚ïê‚ïê */
  header {
    position: sticky; top: 0; z-index: 100;
    background: var(--surf); border-bottom: 1px solid var(--bdr);
    box-shadow: 0 1px 4px var(--shadow);
  }
  .header-inner {
    max-width: 1200px; margin: 0 auto;
    display: flex; align-items: center; gap: 0;
    padding: 0 24px; height: 56px;
  }
  .eyebrow-wrap { margin-right: 32px; }
  .eyebrow { font-size: 9px; letter-spacing: 0.32em; color: var(--acc); text-transform: uppercase; }
  .brand {
    font-family: 'Bebas Neue', sans-serif; font-size: 28px; letter-spacing: 0.06em;
    color: var(--txt); line-height: 1;
  }
  .brand span { color: var(--acc); }

  .nav-pills { display: flex; gap: 2px; }
  .npill {
    font-family: 'Bebas Neue', sans-serif; font-size: 13px; letter-spacing: 0.1em;
    padding: 6px 14px; border-radius: 50px; border: 1px solid transparent;
    background: transparent; color: var(--muted); cursor: pointer; transition: all 0.15s;
    -webkit-tap-highlight-color: transparent;
  }
  .npill:hover { color: var(--acc); background: var(--surf2); border-color: var(--bdr); }
  .npill.on { background: var(--acc); border-color: var(--acc); color: #fff; }

  .h-spacer { flex: 1; }

  .live-pill {
    display: flex; align-items: center; gap: 6px;
    background: rgba(212,43,43,0.07); border: 1px solid rgba(212,43,43,0.2);
    border-radius: 50px; padding: 5px 12px; margin-right: 14px;
    font-size: 10px; letter-spacing: 0.2em; text-transform: uppercase; color: var(--acc2);
  }
  .live-dot {
    width: 6px; height: 6px; border-radius: 50%; background: var(--acc2);
    animation: pulse 1.6s ease-in-out infinite;
  }
  @keyframes pulse { 0%,100%{opacity:1;transform:scale(1)} 50%{opacity:0.5;transform:scale(0.75)} }

  /* ‚ïê‚ïê WRAP ‚ïê‚ïê */
  .wrap { max-width: 1200px; margin: 0 auto; padding: 28px 24px 64px; position: relative; z-index: 1; }

  /* ‚ïê‚ïê PLAYER SECTION ‚ïê‚ïê */
  .sdiv {
    font-family: 'Bebas Neue', sans-serif; font-size: 11px; letter-spacing: 0.28em;
    text-transform: uppercase; color: var(--muted);
    display: flex; align-items: center; gap: 10px; margin-bottom: 14px;
  }
  .sdiv::after { content: ''; flex: 1; height: 1px; background: var(--bdr); }
  .sdiv-badge {
    font-family: 'Barlow', sans-serif; font-size: 9px; font-weight: 400;
    letter-spacing: 0.1em; color: var(--muted); background: var(--surf2);
    border: 1px solid var(--bdr); border-radius: 50px; padding: 2px 10px;
  }

  /* Player card */
  .player-card {
    background: var(--surf); border: 1px solid var(--bdr); border-radius: 14px;
    overflow: hidden; margin-bottom: 28px;
    box-shadow: 0 2px 12px var(--shadow);
    animation: fadeUp 0.25s ease;
  }
  @keyframes fadeUp { from{opacity:0;transform:translateY(-6px)} to{opacity:1;transform:translateY(0)} }

  /* Video wrapper */
  .video-wrap {
    position: relative;
    width: 100%; aspect-ratio: 16/9;
    background: #000; overflow: hidden;
    cursor: pointer;
  }
  video { width:100%; height:100%; display:block; object-fit:contain; background:#000; }

  /* Gradients */
  .vg-top {
    position: absolute; top:0; left:0; right:0; height:80px;
    background: linear-gradient(to bottom, rgba(0,0,0,0.55), transparent);
    pointer-events: none; z-index: 2;
  }
  .vg-bot {
    position: absolute; bottom:0; left:0; right:0; height:160px;
    background: linear-gradient(to top, rgba(0,0,0,0.88), transparent);
    pointer-events: none; z-index: 2;
  }

  /* Channel badge (top-left) */
  .ch-badge {
    position: absolute; top:14px; left:16px; z-index:5;
    display: flex; align-items: center; gap:8px;
    background: rgba(255,255,255,0.1); backdrop-filter: blur(10px);
    border: 1px solid rgba(255,255,255,0.18); border-radius: 8px;
    padding: 7px 12px;
    opacity:0; transition:opacity 0.3s; pointer-events:none;
  }
  .video-wrap:hover .ch-badge,
  .video-wrap.show-ctrl .ch-badge { opacity:1; }
  .ch-badge-num {
    font-size: 9px; letter-spacing: 0.2em; color: rgba(255,255,255,0.5);
    font-family: 'Bebas Neue', sans-serif;
  }
  .ch-badge-name { font-size: 13px; font-weight: 600; color: #fff; }
  .ch-badge-live {
    display: flex; align-items: center; gap:4px; font-size:9px; letter-spacing:0.15em;
    color: var(--acc2); background: rgba(212,43,43,0.15); border-radius:50px; padding:2px 8px;
  }

  /* Kbd hints top-right */
  .kbd-row {
    position: absolute; top:14px; right:16px; z-index:5;
    display: flex; gap:5px;
    opacity:0; transition:opacity 0.3s; pointer-events:none;
  }
  .video-wrap:hover .kbd-row { opacity:1; }
  .kbd {
    font-size:9px; letter-spacing:0.04em; color:rgba(255,255,255,0.3);
    background: rgba(0,0,0,0.35); border:1px solid rgba(255,255,255,0.08);
    border-radius:5px; padding:3px 7px;
  }

  /* Player state overlay */
  .ps-overlay {
    position:absolute; inset:0; z-index:10;
    display:flex; flex-direction:column; align-items:center; justify-content:center; gap:14px;
    background: rgba(0,0,0,0.5); transition:opacity 0.3s;
  }
  .ps-overlay.gone { opacity:0; pointer-events:none; }
  .ps-spinner {
    width:46px; height:46px;
    border: 2px solid rgba(255,255,255,0.08);
    border-top-color: var(--acc); border-radius:50%;
    animation: spin 0.75s linear infinite;
  }
  @keyframes spin { to{transform:rotate(360deg)} }
  .ps-txt {
    font-size:10px; letter-spacing:0.2em; text-transform:uppercase;
    color:rgba(255,255,255,0.45);
  }
  .ps-idle-icon {
    width:64px; height:64px; border-radius:16px;
    background:rgba(255,255,255,0.07); border:1px solid rgba(255,255,255,0.12);
    display:flex; align-items:center; justify-content:center; margin-bottom:4px;
  }
  .ps-idle-title { font-family:'Bebas Neue',sans-serif; font-size:22px; letter-spacing:0.05em; color:rgba(255,255,255,0.8); }
  .ps-idle-sub { font-size:12px; color:rgba(255,255,255,0.35); letter-spacing:0.05em; }
  .ps-err-icon { font-size:32px; }
  .ps-err-title { font-family:'Bebas Neue',sans-serif; font-size:20px; letter-spacing:0.05em; color:#fff; }
  .ps-err-msg { font-size:12px; color:rgba(255,255,255,0.45); text-align:center; max-width:280px; line-height:1.7; }
  .ps-retry {
    background: var(--acc); border:none; border-radius:7px; color:#fff;
    font-family:'Bebas Neue',sans-serif; font-size:16px; letter-spacing:0.1em;
    padding:10px 28px; cursor:pointer; transition:all 0.15s; margin-top:2px;
  }
  .ps-retry:hover { opacity:0.85; transform:translateY(-1px); }

  /* Controls */
  .ctrl-wrap {
    position:absolute; bottom:0; left:0; right:0; z-index:8;
    padding:32px 18px 14px;
    opacity:0; transition:opacity 0.25s;
  }
  .video-wrap:hover .ctrl-wrap,
  .video-wrap.paused .ctrl-wrap,
  .video-wrap.show-ctrl .ctrl-wrap { opacity:1; }

  .prog-area { padding:7px 0; cursor:pointer; margin-bottom:6px; }
  .prog-track {
    height:3px; background:rgba(255,255,255,0.15); border-radius:2px;
    position:relative; transition:height 0.15s;
  }
  .prog-area:hover .prog-track { height:5px; }
  .prog-fill {
    position:absolute; inset:0; border-radius:2px;
    background: linear-gradient(90deg, rgba(26,140,53,0.4) 0%, var(--acc) 80%, rgba(255,255,255,0.85) 100%);
  }
  .prog-thumb {
    position:absolute; right:-5px; top:50%; transform:translateY(-50%);
    width:11px; height:11px; border-radius:50%; background:#fff;
    box-shadow:0 2px 6px rgba(0,0,0,0.4); opacity:0; transition:opacity 0.15s;
  }
  .prog-area:hover .prog-thumb { opacity:1; }

  .ctrl-bar { display:flex; align-items:center; gap:6px; }
  .cbtn {
    background:none; border:none; cursor:pointer;
    color:rgba(255,255,255,0.75); padding:6px; border-radius:7px;
    display:flex; align-items:center; transition:all 0.15s;
    -webkit-tap-highlight-color:transparent;
  }
  .cbtn:hover { background:rgba(255,255,255,0.1); color:#fff; }
  .vol-wrap { display:flex; align-items:center; gap:4px; }
  .vol-sl {
    -webkit-appearance:none; width:68px; height:3px;
    background:rgba(255,255,255,0.2); border-radius:2px; outline:none; cursor:pointer;
  }
  .vol-sl::-webkit-slider-thumb { -webkit-appearance:none; width:11px; height:11px; border-radius:50%; background:#fff; cursor:pointer; }
  .c-spacer { flex:1; }
  .c-chname { font-size:12px; font-weight:600; color:rgba(255,255,255,0.65); letter-spacing:0.02em; }
  .c-live {
    font-size:9px; letter-spacing:0.15em;
    color: var(--acc2); background:rgba(212,43,43,0.15); border:1px solid rgba(212,43,43,0.25);
    border-radius:5px; padding:3px 8px;
  }
  .c-qual {
    font-size:9px; letter-spacing:0.1em;
    color:rgba(255,255,255,0.4); background:rgba(255,255,255,0.07);
    border:1px solid rgba(255,255,255,0.1); border-radius:5px; padding:3px 8px;
    transition:all 0.3s;
  }
  .c-qual.hd { color:rgba(100,160,255,0.9); background:rgba(100,160,255,0.1); border-color:rgba(100,160,255,0.25); }

  /* Player info bar */
  .player-infobar {
    display:flex; align-items:center; gap:14px; flex-wrap:wrap;
    padding:13px 18px; border-top:1px solid var(--bdr);
    background: var(--surf2);
  }
  .infobar-ch { font-family:'Bebas Neue',sans-serif; font-size:17px; letter-spacing:0.06em; color:var(--txt); }
  .infobar-sep { width:1px; height:16px; background:var(--bdr); }
  .infobar-tag {
    font-size:10px; letter-spacing:0.12em; text-transform:uppercase;
    border:1px solid var(--bdr); border-radius:50px; padding:3px 10px; color:var(--muted);
  }
  .infobar-tag.live { color:var(--acc2); border-color:rgba(212,43,43,0.3); background:rgba(212,43,43,0.05); }
  .infobar-tag.dash { color:var(--acc); border-color:rgba(26,140,53,0.3); background:rgba(26,140,53,0.05); }
  .infobar-spacer { flex:1; }
  .infobar-qual {
    font-size:10px; letter-spacing:0.1em; color:var(--muted);
  }
  .infobar-qual.hd { color:var(--acc4); font-weight:600; }

  /* ‚ïê‚ïê CHANNEL GRID ‚ïê‚ïê */
  .ch-grid {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 12px;
  }

  .ch-card {
    background: var(--surf); border: 1px solid var(--bdr); border-radius: 12px;
    padding: 0; cursor: pointer; overflow: hidden;
    transition: all 0.18s cubic-bezier(0.4,0,0.2,1);
    position: relative;
  }
  .ch-card:hover {
    border-color: var(--acc); transform: translateY(-2px);
    box-shadow: 0 6px 20px var(--shadow);
  }
  .ch-card.active {
    border-color: var(--acc);
    box-shadow: 0 0 0 3px var(--glow), 0 6px 20px var(--shadow);
    transform: translateY(-2px);
  }

  /* Art area */
  .ch-art {
    height: 80px; display:flex; align-items:center; justify-content:center;
    font-size: 30px; position:relative; overflow:hidden;
    transition: transform 0.2s;
  }
  .ch-card:hover .ch-art { transform: scale(1.04); }
  .ch-art-num {
    position:absolute; top:8px; left:10px;
    font-family:'Bebas Neue',sans-serif; font-size:13px; letter-spacing:0.1em;
    color:rgba(0,0,0,0.25);
  }
  .ch-art-live {
    position:absolute; top:8px; right:8px;
    display:flex; align-items:center; gap:4px;
    font-size:8px; letter-spacing:0.14em; text-transform:uppercase;
    color:var(--acc2); background:rgba(255,255,255,0.82);
    border:1px solid rgba(212,43,43,0.2); border-radius:50px; padding:2px 7px;
  }
  .ch-art-live-dot { width:4px; height:4px; border-radius:50%; background:var(--acc2); animation:pulse 1.6s ease-in-out infinite; }

  /* Active play indicator */
  .ch-playing-bar {
    position:absolute; bottom:0; left:0; right:0; height:3px;
    background: var(--acc); transform:scaleX(0); transition:transform 0.3s; transform-origin:left;
  }
  .ch-card.active .ch-playing-bar { transform:scaleX(1); }

  /* Info area */
  .ch-info {
    padding: 10px 12px 12px; border-top:1px solid var(--bdr);
    background: var(--surf);
  }
  .ch-name {
    font-family:'Bebas Neue',sans-serif; font-size:15px; letter-spacing:0.06em;
    color:var(--txt); margin-bottom:3px; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;
  }
  .ch-card.active .ch-name { color:var(--acc); }
  .ch-meta {
    font-size:10px; color:var(--muted); letter-spacing:0.04em;
    display:flex; align-items:center; gap:5px;
  }
  .ch-meta-dot { width:3px; height:3px; border-radius:50%; background:var(--bdr); }

  /* Now playing chip */
  .now-playing {
    display:inline-flex; align-items:center; gap:4px;
    font-size:9px; letter-spacing:0.12em; text-transform:uppercase;
    color:var(--acc); background:rgba(26,140,53,0.08);
    border:1px solid rgba(26,140,53,0.2); border-radius:50px; padding:2px 8px;
    margin-top:5px;
  }
  .now-playing-dot { width:4px; height:4px; border-radius:50%; background:var(--acc); animation:pulse 1.6s ease-in-out infinite; }

  /* ‚ïê‚ïê TOAST ‚ïê‚ïê */
  .toast {
    position:fixed; bottom:28px; left:50%;
    transform:translateX(-50%) translateY(16px);
    background:var(--txt); color:var(--bg);
    border-radius:50px; padding:10px 20px;
    font-size:12px; font-weight:400; letter-spacing:0.06em;
    z-index:200; pointer-events:none; opacity:0;
    transition:all 0.3s cubic-bezier(0.4,0,0.2,1);
    white-space:nowrap; box-shadow:0 8px 32px rgba(0,0,0,0.15);
  }
  .toast.show { opacity:1; transform:translateX(-50%) translateY(0); }

  /* ‚ïê‚ïê RESPONSIVE ‚ïê‚ïê */
  @media (max-width:900px) {
    .ch-grid { grid-template-columns: repeat(3,1fr); gap:10px; }
    .nav-pills { display:none; }
  }
  @media (max-width:600px) {
    .wrap { padding:18px 14px 48px; }
    .header-inner { padding:0 14px; }
    .ch-grid { grid-template-columns: repeat(2,1fr); gap:9px; }
    .ch-art { height:64px; font-size:24px; }
    .vol-wrap { display:none; }
    .kbd-row { display:none; }
    .player-infobar { padding:10px 14px; gap:10px; }
    .infobar-qual { display:none; }
  }
  @media (max-width:380px) {
    .ch-grid { grid-template-columns: repeat(2,1fr); gap:7px; }
    .ch-art { height:52px; }
  }
</style>
</head>
<body>

<!-- ‚ïê‚ïê HEADER ‚ïê‚ïê -->
<header>
  <div class="header-inner">
    <div class="eyebrow-wrap">
      <div class="eyebrow">Live Streaming</div>
      <div class="brand">PRISM<span>TV</span></div>
    </div>
    <div class="nav-pills">
      <button class="npill on">Live TV</button>
      <button class="npill">Sports</button>
      <button class="npill">News</button>
      <button class="npill">Movies</button>
    </div>
    <div class="h-spacer"></div>
    <div class="live-pill"><span class="live-dot"></span>ON AIR</div>
  </div>
</header>

<div class="wrap">

  <!-- ‚ïê‚ïê PLAYER ‚ïê‚ïê -->
  <div class="sdiv">
    Now Playing
    <span class="sdiv-badge">DASH ¬∑ ClearKey DRM</span>
  </div>

  <div class="player-card" id="player-card">
    <div class="video-wrap" id="vw">
      <video id="vid" playsinline></video>
      <div class="vg-top"></div>
      <div class="vg-bot"></div>

      <!-- Channel badge -->
      <div class="ch-badge" id="ch-badge">
        <span class="ch-badge-num" id="badge-num">CH 01</span>
        <span class="ch-badge-name" id="badge-name">‚Äî</span>
        <div class="ch-badge-live"><span class="live-dot"></span>LIVE</div>
      </div>

      <!-- Keyboard hints -->
      <div class="kbd-row">
        <span class="kbd">SPACE</span>
        <span class="kbd">M mute</span>
        <span class="kbd">F fullscreen</span>
        <span class="kbd">1‚Äì8</span>
      </div>

      <!-- State overlay -->
      <div class="ps-overlay" id="pso">
        <div class="ps-idle-icon">
          <svg width="28" height="28" viewBox="0 0 24 24" fill="rgba(255,255,255,0.65)"><path d="M8 5v14l11-7z"/></svg>
        </div>
        <div class="ps-idle-title">Select a Channel</div>
        <div class="ps-idle-sub">Choose from the grid below</div>
      </div>

      <!-- Controls -->
      <div class="ctrl-wrap">
        <div class="prog-area">
          <div class="prog-track">
            <div class="prog-fill"></div>
            <div class="prog-thumb"></div>
          </div>
        </div>
        <div class="ctrl-bar">
          <button class="cbtn" onclick="togglePlay()">
            <svg id="play-icon" width="22" height="22" viewBox="0 0 24 24" fill="currentColor"><path d="M8 5v14l11-7z"/></svg>
          </button>
          <div class="vol-wrap">
            <button class="cbtn" onclick="toggleMute()">
              <svg id="mute-icon" width="18" height="18" viewBox="0 0 24 24" fill="currentColor"><path d="M3 9v6h4l5 5V4L7 9H3zm13.5 3c0-1.77-1.02-3.29-2.5-4.03v8.05c1.48-.73 2.5-2.25 2.5-4.02zM14 3.23v2.06c2.89.86 5 3.54 5 6.71s-2.11 5.85-5 6.71v2.06c4.01-.91 7-4.49 7-8.77s-2.99-7.86-7-8.77z"/></svg>
            </button>
            <input class="vol-sl" id="vol" type="range" min="0" max="1" step="0.02" value="1" oninput="setVol(this.value)">
          </div>
          <div class="c-spacer"></div>
          <span class="c-chname" id="c-chname"></span>
          <span class="c-live">‚óè LIVE</span>
          <span class="c-qual" id="c-qual">‚Äî</span>
          <button class="cbtn" onclick="toggleFS()">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor"><path d="M7 14H5v5h5v-2H7v-3zm-2-4h2V7h3V5H5v5zm12 7h-3v2h5v-5h-2v3zM14 5v2h3v3h2V5h-5z"/></svg>
          </button>
        </div>
      </div>
    </div>

    <!-- Info bar below player -->
    <div class="player-infobar">
      <span class="infobar-ch" id="ib-ch">Select a channel to begin</span>
      <div class="infobar-sep"></div>
      <span class="infobar-tag live">‚óè LIVE</span>
      <span class="infobar-tag dash">DASH</span>
      <div class="infobar-spacer"></div>
      <span class="infobar-qual" id="ib-qual">‚Äî</span>
    </div>
  </div>

  <!-- ‚ïê‚ïê CHANNELS ‚ïê‚ïê -->
  <div class="sdiv">
    All Channels
    <span class="sdiv-badge" id="ch-count-badge">8 CHANNELS</span>
  </div>

  <div class="ch-grid" id="ch-grid"></div>

</div>

<div class="toast" id="toast"></div>

<script>
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  CHANNELS CONFIG
//  Replace manifest + keys per channel
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
const CHANNELS = [
  {
    id:1, name:'Cric Life 2', tag:'Sports ¬∑ HD', emoji:'üèè',
    bg:'#d1fae5', // art background color
    manifest:'https://ev-fast-mpd.starzplayarabia.com/live/eds/CricLife2/DASH/CricLife2.mpd',
    keys:{'48bef83b4c6a3c5189b01b0126210da4':'bd085230b7b09e50954fe0af111a8a9f'}
  },
  {
    id:2, name:'Channel 2', tag:'Entertainment', emoji:'üé¨',
    bg:'#fce7f3',
    manifest:'https://ev-fast-mpd.starzplayarabia.com/live/eds/CricLife2/DASH/CricLife2.mpd',
    keys:{'48bef83b4c6a3c5189b01b0126210da4':'bd085230b7b09e50954fe0af111a8a9f'}
  },
  {
    id:3, name:'Channel 3', tag:'News ¬∑ Live', emoji:'üì°',
    bg:'#fef3c7',
    manifest:'https://ev-fast-mpd.starzplayarabia.com/live/eds/CricLife2/DASH/CricLife2.mpd',
    keys:{'48bef83b4c6a3c5189b01b0126210da4':'bd085230b7b09e50954fe0af111a8a9f'}
  },
  {
    id:4, name:'Channel 4', tag:'Sports ¬∑ Live', emoji:'‚öΩ',
    bg:'#dcfce7',
    manifest:'https://ev-fast-mpd.starzplayarabia.com/live/eds/CricLife2/DASH/CricLife2.mpd',
    keys:{'48bef83b4c6a3c5189b01b0126210da4':'bd085230b7b09e50954fe0af111a8a9f'}
  },
  {
    id:5, name:'Channel 5', tag:'Movies ¬∑ HD', emoji:'üé•',
    bg:'#ede9fe',
    manifest:'https://ev-fast-mpd.starzplayarabia.com/live/eds/CricLife2/DASH/CricLife2.mpd',
    keys:{'48bef83b4c6a3c5189b01b0126210da4':'bd085230b7b09e50954fe0af111a8a9f'}
  },
  {
    id:6, name:'Channel 6', tag:'Music ¬∑ Live', emoji:'üéµ',
    bg:'#fff1f2',
    manifest:'https://ev-fast-mpd.starzplayarabia.com/live/eds/CricLife2/DASH/CricLife2.mpd',
    keys:{'48bef83b4c6a3c5189b01b0126210da4':'bd085230b7b09e50954fe0af111a8a9f'}
  },
  {
    id:7, name:'Channel 7', tag:'Kids ¬∑ HD', emoji:'üß∏',
    bg:'#fff7ed',
    manifest:'https://ev-fast-mpd.starzplayarabia.com/live/eds/CricLife2/DASH/CricLife2.mpd',
    keys:{'48bef83b4c6a3c5189b01b0126210da4':'bd085230b7b09e50954fe0af111a8a9f'}
  },
  {
    id:8, name:'Channel 8', tag:'Documentary', emoji:'üåç',
    bg:'#f0fdf4',
    manifest:'https://ev-fast-mpd.starzplayarabia.com/live/eds/CricLife2/DASH/CricLife2.mpd',
    keys:{'48bef83b4c6a3c5189b01b0126210da4':'bd085230b7b09e50954fe0af111a8a9f'}
  }
];

// ‚îÄ‚îÄ STATE ‚îÄ‚îÄ
let player = null, activeCh = null;
const vid = document.getElementById('vid');
const vw  = document.getElementById('vw');

// ‚îÄ‚îÄ BUILD CHANNEL GRID ‚îÄ‚îÄ
function buildGrid() {
  const grid = document.getElementById('ch-grid');
  CHANNELS.forEach(ch => {
    const el = document.createElement('div');
    el.className = 'ch-card';
    el.id = 'card-' + ch.id;
    el.innerHTML = `
      <div class="ch-art" style="background:${ch.bg}">
        <span class="ch-art-num">CH ${String(ch.id).padStart(2,'0')}</span>
        ${ch.emoji}
        <div class="ch-art-live"><span class="ch-art-live-dot"></span>LIVE</div>
      </div>
      <div class="ch-playing-bar"></div>
      <div class="ch-info">
        <div class="ch-name">${ch.name}</div>
        <div class="ch-meta">${ch.tag}<span class="ch-meta-dot"></span>DASH</div>
        <div class="now-playing" id="np-${ch.id}" style="display:none">
          <span class="now-playing-dot"></span>Now Playing
        </div>
      </div>`;
    el.onclick = () => loadChannel(ch);
    grid.appendChild(el);
  });
}

// ‚îÄ‚îÄ SET ACTIVE ‚îÄ‚îÄ
function setActive(ch) {
  document.querySelectorAll('.ch-card').forEach(e => e.classList.remove('active'));
  document.querySelectorAll('[id^="np-"]').forEach(e => e.style.display = 'none');
  const card = document.getElementById('card-' + ch.id);
  if (card) {
    card.classList.add('active');
    card.scrollIntoView({ behavior:'smooth', block:'nearest' });
  }
  const np = document.getElementById('np-' + ch.id);
  if (np) np.style.display = 'inline-flex';
  // Update overlays & info bar
  document.getElementById('badge-num').textContent  = 'CH ' + String(ch.id).padStart(2,'0');
  document.getElementById('badge-name').textContent = ch.name;
  document.getElementById('c-chname').textContent   = ch.name;
  document.getElementById('ib-ch').textContent      = ch.name;
}

// ‚îÄ‚îÄ LOAD CHANNEL ‚îÄ‚îÄ
async function loadChannel(ch) {
  if (activeCh && activeCh.id === ch.id) return;
  activeCh = ch;
  setActive(ch);
  setPSO('loading', 'Loading ' + ch.name + '‚Ä¶');
  setQual('‚Ä¶', false);

  try {
    if (player) { await player.destroy(); player = null; }

    shaka.polyfill.installAll();
    if (!shaka.Player.isBrowserSupported()) {
      setPSO('error', 'Browser does not support DASH/EME playback.'); return;
    }

    player = new shaka.Player(vid);

    player.addEventListener('error', e => {
      console.error(e.detail);
      setPSO('error', 'Error ' + e.detail.code + ' ‚Äî ' + (e.detail.message || 'Check network and try again.'));
    });
    player.addEventListener('buffering', e => {
      if (e.buffering) setPSO('loading', 'Buffering‚Ä¶');
      else setPSO('hide');
    });
    player.addEventListener('adaptation', updateQual);

    const cfg = {
      streaming: {
        bufferingGoal: 12, rebufferingGoal: 2, bufferBehind: 30,
        retryParameters: { maxAttempts: 6, baseDelay: 1000, backoffFactor: 2, fuzzFactor: 0.5 }
      }
    };
    if (ch.keys && Object.keys(ch.keys).length) cfg.drm = { clearKeys: ch.keys };
    player.configure(cfg);

    await player.load(ch.manifest);
    vid.play();
    setPSO('hide');
    updateQual();
    showToast('‚ñ∂  ' + ch.name);

  } catch(e) {
    console.error(e);
    setPSO('error', 'Could not load stream.\n' + (e.message || 'Unknown error'));
  }
}

// ‚îÄ‚îÄ PLAYER STATE OVERLAY ‚îÄ‚îÄ
function setPSO(type, msg) {
  const el = document.getElementById('pso');
  if (type === 'hide') { el.classList.add('gone'); return; }
  el.classList.remove('gone');
  if (type === 'loading') {
    el.innerHTML = `<div class="ps-spinner"></div><div class="ps-txt">${msg || 'Loading‚Ä¶'}</div>`;
  } else if (type === 'error') {
    el.innerHTML = `
      <div class="ps-err-icon">‚ö†Ô∏è</div>
      <div class="ps-err-title">Stream Unavailable</div>
      <div class="ps-err-msg">${msg || ''}</div>
      <button class="ps-retry" onclick="retryChannel()">‚Ü∫  Retry</button>`;
  }
}
function retryChannel() {
  if (activeCh) { const c = activeCh; activeCh = null; loadChannel(c); }
}

// ‚îÄ‚îÄ QUALITY ‚îÄ‚îÄ
function updateQual() {
  if (!player) return;
  try {
    const t = player.getVariantTracks().find(t => t.active);
    if (t) {
      const h = t.height || 0;
      const label = h >= 1080 ? 'FHD' : h >= 720 ? 'HD' : h > 0 ? h + 'p' : 'SD';
      const bw = t.bandwidth ? '  ¬∑  ' + Math.round(t.bandwidth / 1000) + ' kbps' : '';
      setQual(label + bw, h >= 720);
    }
  } catch(e) {}
}
function setQual(txt, isHD) {
  document.getElementById('c-qual').textContent = txt;
  document.getElementById('c-qual').className = 'c-qual' + (isHD ? ' hd' : '');
  document.getElementById('ib-qual').textContent = txt;
  document.getElementById('ib-qual').className = 'infobar-qual' + (isHD ? ' hd' : '');
}

// ‚îÄ‚îÄ CONTROLS ‚îÄ‚îÄ
function togglePlay() { if (vid.paused) vid.play(); else vid.pause(); }

vid.addEventListener('play', () => {
  document.getElementById('play-icon').innerHTML = '<path d="M6 19h4V5H6v14zm8-14v14h4V5h-4z"/>';
  vw.classList.remove('paused');
});
vid.addEventListener('pause', () => {
  document.getElementById('play-icon').innerHTML = '<path d="M8 5v14l11-7z"/>';
  vw.classList.add('paused');
});

function setVol(v) { vid.volume = parseFloat(v); updateMuteIcon(); }
function toggleMute() { vid.muted = !vid.muted; updateMuteIcon(); }
function updateMuteIcon() {
  document.getElementById('mute-icon').innerHTML = (vid.muted || vid.volume === 0)
    ? '<path d="M16.5 12c0-1.77-1.02-3.29-2.5-4.03v2.21l2.45 2.45c.03-.2.05-.41.05-.63zm2.5 0c0 .94-.2 1.82-.54 2.64l1.51 1.51C20.63 14.91 21 13.5 21 12c0-4.28-2.99-7.86-7-8.77v2.06c2.89.86 5 3.54 5 6.71zM4.27 3L3 4.27 7.73 9H3v6h4l5 5v-6.73l4.25 4.25c-.67.52-1.42.93-2.25 1.18v2.06c1.38-.31 2.63-.95 3.69-1.81L19.73 21 21 19.73l-9-9L4.27 3zM12 4L9.91 6.09 12 8.18V4z"/>'
    : '<path d="M3 9v6h4l5 5V4L7 9H3zm13.5 3c0-1.77-1.02-3.29-2.5-4.03v8.05c1.48-.73 2.5-2.25 2.5-4.02zM14 3.23v2.06c2.89.86 5 3.54 5 6.71s-2.11 5.85-5 6.71v2.06c4.01-.91 7-4.49 7-8.77s-2.99-7.86-7-8.77z"/>';
}

function toggleFS() {
  if (!document.fullscreenElement) vw.requestFullscreen && vw.requestFullscreen();
  else document.exitFullscreen && document.exitFullscreen();
}

// Auto-hide controls
let ctrlTimer;
vw.addEventListener('mousemove', () => {
  vw.classList.add('show-ctrl');
  clearTimeout(ctrlTimer);
  ctrlTimer = setTimeout(() => vw.classList.remove('show-ctrl'), 3000);
});
vw.addEventListener('touchstart', () => vw.classList.toggle('show-ctrl'));

// Click to play/pause
vw.addEventListener('click', e => {
  if (e.target.closest('.cbtn') || e.target.closest('.vol-sl')) return;
  if (activeCh) togglePlay();
});

// ‚îÄ‚îÄ TOAST ‚îÄ‚îÄ
let toastTimer;
function showToast(msg) {
  const t = document.getElementById('toast');
  t.textContent = msg; t.classList.add('show');
  clearTimeout(toastTimer);
  toastTimer = setTimeout(() => t.classList.remove('show'), 2400);
}

// ‚îÄ‚îÄ KEYBOARD ‚îÄ‚îÄ
document.addEventListener('keydown', e => {
  if (e.target.tagName === 'INPUT') return;
  if (e.code === 'Space')     { e.preventDefault(); if(activeCh) togglePlay(); }
  if (e.code === 'KeyM')      toggleMute();
  if (e.code === 'KeyF')      toggleFS();
  if (e.code === 'ArrowUp')   { vid.volume = Math.min(1, vid.volume + 0.1); document.getElementById('vol').value = vid.volume; showToast('üîä  ' + Math.round(vid.volume * 100) + '%'); }
  if (e.code === 'ArrowDown') { vid.volume = Math.max(0, vid.volume - 0.1); document.getElementById('vol').value = vid.volume; showToast('üîâ  ' + Math.round(vid.volume * 100) + '%'); }
  const n = parseInt(e.key);
  if (n >= 1 && n <= CHANNELS.length) loadChannel(CHANNELS[n - 1]);
});

// ‚îÄ‚îÄ INIT ‚îÄ‚îÄ
buildGrid();
</script>
</body>
</html>
