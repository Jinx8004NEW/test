<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
<title>PRISM ‚Äî Live TV</title>
<link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Barlow:ital,wght@0,300;0,400;0,600;1,300&display=swap" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/shaka-player/4.7.11/shaka-player.compiled.min.js"></script>
<style>
:root {
  --bg:     #f0f5f1;
  --surf:   #ffffff;
  --surf2:  #e6f0e8;
  --bdr:    #bdd4c2;
  --bdr2:   #9ab8a2;
  --acc:    #1a8c35;
  --acc2:   #d42b2b;
  --acc4:   #0e7a63;
  --txt:    #172a1c;
  --muted:  #537a5c;
  --grid:   rgba(26,140,53,0.05);
  --shadow: rgba(0,0,0,0.07);
  --glow:   rgba(26,140,53,0.12);
}
*,*::before,*::after { box-sizing:border-box; margin:0; padding:0; }
html { -webkit-text-size-adjust:100%; scroll-behavior:smooth; }
body {
  background:var(--bg); color:var(--txt);
  font-family:'Barlow',sans-serif; font-weight:300;
  min-height:100vh; overflow-x:hidden;
  -webkit-font-smoothing:antialiased;
}
body::before {
  content:''; position:fixed; inset:0; z-index:0; pointer-events:none;
  background-image:linear-gradient(var(--grid) 1px,transparent 1px),
                   linear-gradient(90deg,var(--grid) 1px,transparent 1px);
  background-size:36px 36px;
}

/* ‚ïê‚ïê HEADER ‚ïê‚ïê */
header {
  position:sticky; top:0; z-index:100;
  background:var(--surf); border-bottom:1px solid var(--bdr);
  box-shadow:0 1px 4px var(--shadow);
}
.header-inner {
  max-width:1440px; margin:0 auto;
  display:flex; align-items:center;
  padding:0 28px; height:56px; gap:0;
}
.eyebrow-wrap { margin-right:32px; }
.eyebrow { font-size:9px; letter-spacing:0.32em; color:var(--acc); text-transform:uppercase; line-height:1; }
.brand { font-family:'Bebas Neue',sans-serif; font-size:28px; letter-spacing:0.06em; color:var(--txt); line-height:1; }
.brand span { color:var(--acc); }
.h-spacer { flex:1; }
.live-pill {
  display:flex; align-items:center; gap:6px;
  background:rgba(212,43,43,0.07); border:1px solid rgba(212,43,43,0.2);
  border-radius:50px; padding:5px 14px;
  font-size:10px; letter-spacing:0.2em; text-transform:uppercase; color:var(--acc2);
}
.live-dot { width:6px; height:6px; border-radius:50%; background:var(--acc2); animation:pulse 1.6s ease-in-out infinite; }
@keyframes pulse { 0%,100%{opacity:1;transform:scale(1)} 50%{opacity:0.5;transform:scale(0.75)} }
@keyframes fadeUp { from{opacity:0;transform:translateY(-6px)} to{opacity:1;transform:translateY(0)} }
@keyframes spin   { to{transform:rotate(360deg)} }

/* ‚ïê‚ïê MAIN LAYOUT ‚ïê‚ïê */
.wrap {
  max-width:1440px; margin:0 auto;
  padding:28px 28px 64px;
  position:relative; z-index:1;
}
.sdiv {
  font-family:'Bebas Neue',sans-serif; font-size:11px; letter-spacing:0.28em;
  text-transform:uppercase; color:var(--muted);
  display:flex; align-items:center; gap:10px; margin-bottom:14px;
}
.sdiv::after { content:''; flex:1; height:1px; background:var(--bdr); }
.sdiv-badge {
  font-family:'Barlow',sans-serif; font-size:9px; font-weight:400;
  letter-spacing:0.1em; color:var(--muted); background:var(--surf2);
  border:1px solid var(--bdr); border-radius:50px; padding:2px 10px;
}

/* ‚îÄ‚îÄ Desktop: player left + channels right ‚îÄ‚îÄ */
.live-layout {
  display:grid;
  grid-template-columns: 1fr 340px;
  grid-template-rows: auto auto;
  gap:0 24px;
  align-items:start;
}
.live-layout .player-section  { grid-column:1; grid-row:1; }
.live-layout .channels-section { grid-column:2; grid-row:1 / 3; }
.live-layout .sdiv-row          { grid-column:1; grid-row:2; margin-top:20px; }

/* ‚ïê‚ïê PLAYER CARD ‚ïê‚ïê */
.player-card {
  background:var(--surf); border:1px solid var(--bdr); border-radius:14px;
  overflow:hidden; box-shadow:0 2px 16px var(--shadow);
  animation:fadeUp 0.25s ease;
}
.video-wrap {
  position:relative; width:100%; aspect-ratio:16/9;
  background:#000; overflow:hidden; cursor:pointer;
}
video { width:100%; height:100%; display:block; object-fit:contain; background:#000; }

/* Gradient overlays ‚Äî only bottom for controls */
.vg-bot {
  position:absolute; bottom:0; left:0; right:0; height:140px;
  background:linear-gradient(to top,rgba(0,0,0,0.9),transparent);
  pointer-events:none; z-index:2;
}

/* ‚îÄ‚îÄ Player state overlay (idle/loading/error) ‚îÄ‚îÄ */
.ps-overlay {
  position:absolute; inset:0; z-index:10;
  display:flex; flex-direction:column; align-items:center; justify-content:center; gap:14px;
  background:rgba(0,0,0,0.5); transition:opacity 0.3s;
}
.ps-overlay.gone { opacity:0; pointer-events:none; }
.ps-spinner {
  width:46px; height:46px;
  border:2px solid rgba(255,255,255,0.08);
  border-top-color:var(--acc); border-radius:50%;
  animation:spin 0.75s linear infinite;
}
.ps-txt { font-size:10px; letter-spacing:0.2em; text-transform:uppercase; color:rgba(255,255,255,0.45); }
.ps-idle-icon {
  width:64px; height:64px; border-radius:16px;
  background:rgba(255,255,255,0.07); border:1px solid rgba(255,255,255,0.12);
  display:flex; align-items:center; justify-content:center; margin-bottom:4px;
}
.ps-idle-title { font-family:'Bebas Neue',sans-serif; font-size:22px; letter-spacing:0.05em; color:rgba(255,255,255,0.8); }
.ps-idle-sub   { font-size:12px; color:rgba(255,255,255,0.35); letter-spacing:0.05em; }
.ps-err-icon   { font-size:32px; }
.ps-err-title  { font-family:'Bebas Neue',sans-serif; font-size:20px; letter-spacing:0.05em; color:#fff; }
.ps-err-msg    { font-size:12px; color:rgba(255,255,255,0.45); text-align:center; max-width:280px; line-height:1.7; }
.ps-retry {
  background:var(--acc); border:none; border-radius:7px; color:#fff;
  font-family:'Bebas Neue',sans-serif; font-size:16px; letter-spacing:0.1em;
  padding:10px 28px; cursor:pointer; transition:all 0.15s; margin-top:2px;
}
.ps-retry:hover { opacity:0.85; transform:translateY(-1px); }

/* ‚ïê‚ïê PLAYER CONTROLS ‚ïê‚ïê */
.ctrl-wrap {
  position:absolute; bottom:0; left:0; right:0; z-index:8;
  padding:28px 16px 13px; opacity:0; transition:opacity 0.25s;
}
.video-wrap:hover .ctrl-wrap,
.video-wrap.paused .ctrl-wrap,
.video-wrap.show-ctrl .ctrl-wrap { opacity:1; }

.prog-area { padding:6px 0; cursor:default; margin-bottom:5px; }
.prog-track {
  height:3px; background:rgba(255,255,255,0.15); border-radius:2px;
  position:relative; transition:height 0.15s;
}
.prog-fill {
  position:absolute; inset:0; border-radius:2px;
  background:linear-gradient(90deg,rgba(26,140,53,0.5) 0%,var(--acc) 80%,rgba(255,255,255,0.9) 100%);
}
/* live indicator dot at right end */
.prog-live-dot {
  position:absolute; right:0; top:50%; transform:translateY(-50%);
  width:8px; height:8px; border-radius:50%; background:var(--acc2);
  box-shadow:0 0 6px var(--acc2);
}

.ctrl-bar { display:flex; align-items:center; gap:4px; }

/* ‚îÄ‚îÄ LIVE button (far left, clickable to jump to edge) ‚îÄ‚îÄ */
.live-edge-btn {
  display:flex; align-items:center; gap:5px;
  background:rgba(212,43,43,0.18); border:1px solid rgba(212,43,43,0.4);
  border-radius:6px; padding:4px 10px; cursor:pointer;
  font-family:'Bebas Neue',sans-serif; font-size:12px; letter-spacing:0.1em;
  color:rgba(255,100,100,0.95); transition:all 0.15s;
  -webkit-tap-highlight-color:transparent;
}
.live-edge-btn:hover { background:rgba(212,43,43,0.3); color:#fff; border-color:rgba(212,43,43,0.7); }
.live-edge-btn.at-live { background:var(--acc2); border-color:var(--acc2); color:#fff; }
.live-edge-dot {
  width:5px; height:5px; border-radius:50%; background:currentColor;
  animation:pulse 1.4s ease-in-out infinite;
}

.cbtn {
  background:none; border:none; cursor:pointer;
  color:rgba(255,255,255,0.75); padding:6px; border-radius:7px;
  display:flex; align-items:center; transition:all 0.15s;
  -webkit-tap-highlight-color:transparent;
}
.cbtn:hover { background:rgba(255,255,255,0.1); color:#fff; }
.cbtn svg { display:block; }

.vol-wrap { display:flex; align-items:center; gap:3px; }
.vol-sl {
  -webkit-appearance:none; width:68px; height:3px;
  background:rgba(255,255,255,0.2); border-radius:2px; outline:none; cursor:pointer;
}
.vol-sl::-webkit-slider-thumb { -webkit-appearance:none; width:11px; height:11px; border-radius:50%; background:#fff; cursor:pointer; }

.c-spacer { flex:1; }

/* ‚îÄ‚îÄ Quality picker button ‚îÄ‚îÄ */
.qual-wrap { position:relative; display:inline-flex; }
.qual-btn {
  display:flex; align-items:center; gap:4px;
  background:rgba(255,255,255,0.08); border:1px solid rgba(255,255,255,0.2);
  border-radius:6px; padding:4px 9px; cursor:pointer;
  font-family:'Bebas Neue',sans-serif; font-size:12px; letter-spacing:0.08em;
  color:rgba(255,255,255,0.7); transition:all 0.15s;
  -webkit-tap-highlight-color:transparent;
}
.qual-btn:hover { background:rgba(255,255,255,0.14); color:#fff; border-color:rgba(255,255,255,0.3); }
.qual-btn.hd { color:rgba(100,180,255,0.9); border-color:rgba(100,180,255,0.35); background:rgba(100,180,255,0.1); }
.qual-btn svg { width:11px; height:11px; flex-shrink:0; }

/* Quality dropdown panel */
.qual-panel {
  position:absolute; bottom:calc(100% + 10px); right:0;
  background:var(--surf); border:1px solid var(--bdr); border-radius:12px;
  min-width:220px; overflow:hidden; z-index:60;
  box-shadow:0 -4px 24px rgba(0,0,0,0.15), 0 8px 24px rgba(0,0,0,0.12);
  display:none; animation:fadeUp 0.15s ease;
}
.qual-panel.open { display:block; }
.qual-panel-head {
  font-family:'Bebas Neue',sans-serif; font-size:11px; letter-spacing:0.22em;
  color:var(--muted); padding:11px 14px 8px; border-bottom:1px solid var(--bdr);
  display:flex; align-items:center; justify-content:space-between;
}
.qual-panel-head span { font-family:'Barlow',sans-serif; font-size:9px; letter-spacing:0.06em; }
.qrow-auto {
  display:flex; align-items:center; justify-content:space-between;
  padding:10px 14px; cursor:pointer; border-bottom:1px solid var(--bdr);
  transition:background 0.12s;
}
.qrow-auto:hover { background:var(--surf2); }
.qrow-auto.sel { background:rgba(26,140,53,0.05); }
.qrow-auto-left { display:flex; flex-direction:column; gap:2px; }
.qrow-auto-label { font-family:'Bebas Neue',sans-serif; font-size:14px; letter-spacing:0.06em; color:var(--txt); }
.qrow-auto.sel .qrow-auto-label { color:var(--acc); }
.qrow-auto-sub { font-size:10px; color:var(--muted); }
.qrow {
  display:flex; align-items:center; gap:10px;
  padding:9px 14px; cursor:pointer; border-bottom:1px solid var(--bdr);
  transition:background 0.12s;
}
.qrow:last-child { border-bottom:none; }
.qrow:hover { background:var(--surf2); }
.qrow.sel { background:rgba(26,140,53,0.05); }
.qrow-res { font-family:'Bebas Neue',sans-serif; font-size:16px; letter-spacing:0.04em; color:var(--txt); min-width:52px; }
.qrow.sel .qrow-res { color:var(--acc); }
.qrow-fps {
  font-size:9px; letter-spacing:0.1em; color:var(--muted);
  background:var(--surf2); border:1px solid var(--bdr);
  border-radius:4px; padding:2px 6px; white-space:nowrap;
}
.qrow.sel .qrow-fps { color:var(--acc4); border-color:rgba(14,122,99,0.3); background:rgba(14,122,99,0.07); }
.qrow-bw { font-size:10px; color:var(--muted); flex:1; text-align:right; }
.qrow-check {
  width:16px; height:16px; border-radius:50%; flex-shrink:0;
  background:var(--acc); display:flex; align-items:center; justify-content:center;
  visibility:hidden;
}
.qrow.sel .qrow-check, .qrow-auto.sel .qrow-check { visibility:visible; }

/* ‚ïê‚ïê PLAYER INFO BAR ‚ïê‚ïê */
.player-infobar {
  display:flex; align-items:center; gap:12px; flex-wrap:wrap;
  padding:12px 16px; border-top:1px solid var(--bdr);
  background:var(--surf2);
}
.infobar-ch { font-family:'Bebas Neue',sans-serif; font-size:17px; letter-spacing:0.06em; color:var(--txt); }
.infobar-sep { width:1px; height:16px; background:var(--bdr); flex-shrink:0; }
.infobar-tag {
  font-size:10px; letter-spacing:0.12em; text-transform:uppercase;
  border:1px solid var(--bdr); border-radius:50px; padding:3px 10px; color:var(--muted);
}
.infobar-tag.live { color:var(--acc2); border-color:rgba(212,43,43,0.3); background:rgba(212,43,43,0.05); }
.infobar-tag.dash { color:var(--acc); border-color:rgba(26,140,53,0.3); background:rgba(26,140,53,0.05); }
.infobar-spacer { flex:1; }
.infobar-qual { font-size:10px; color:var(--muted); letter-spacing:0.06em; }
.infobar-qual.hd { color:var(--acc4); font-weight:600; }

/* ‚ïê‚ïê CHANNEL GRID ‚Äî desktop: vertical list in sidebar ‚ïê‚ïê */
.channels-section {
  background:var(--surf); border:1px solid var(--bdr); border-radius:14px;
  overflow:hidden; box-shadow:0 2px 12px var(--shadow);
}
.ch-list-head {
  padding:14px 16px 10px; border-bottom:1px solid var(--bdr);
  background:var(--surf2);
  display:flex; align-items:center; justify-content:space-between;
}
.ch-list-title { font-family:'Bebas Neue',sans-serif; font-size:13px; letter-spacing:0.2em; color:var(--muted); }
.ch-list-count {
  font-family:'Barlow',sans-serif; font-size:9px; font-weight:400; letter-spacing:0.1em;
  color:var(--muted); background:var(--bg); border:1px solid var(--bdr);
  border-radius:50px; padding:2px 9px;
}
.ch-list { overflow-y:auto; max-height:calc(100vh - 200px); }

/* Scrollbar styling */
.ch-list::-webkit-scrollbar { width:4px; }
.ch-list::-webkit-scrollbar-track { background:transparent; }
.ch-list::-webkit-scrollbar-thumb { background:var(--bdr); border-radius:2px; }

.ch-row {
  display:flex; align-items:center; gap:12px;
  padding:12px 16px; border-bottom:1px solid var(--bdr);
  cursor:pointer; transition:all 0.15s;
  position:relative; overflow:hidden;
}
.ch-row:last-child { border-bottom:none; }
.ch-row:hover { background:var(--surf2); }
.ch-row.active { background:rgba(26,140,53,0.05); }
.ch-row-active-bar {
  position:absolute; left:0; top:0; bottom:0; width:3px;
  background:var(--acc); transform:scaleY(0); transition:transform 0.25s; transform-origin:top;
}
.ch-row.active .ch-row-active-bar { transform:scaleY(1); }

.ch-row-art {
  width:52px; height:40px; border-radius:8px; flex-shrink:0;
  display:flex; align-items:center; justify-content:center;
  font-size:20px; overflow:hidden; transition:transform 0.2s;
  position:relative;
}
.ch-row:hover .ch-row-art { transform:scale(1.06); }

.ch-row-info { flex:1; min-width:0; }
.ch-row-name {
  font-family:'Bebas Neue',sans-serif; font-size:14px; letter-spacing:0.04em; color:var(--txt);
  white-space:nowrap; overflow:hidden; text-overflow:ellipsis; margin-bottom:2px;
}
.ch-row.active .ch-row-name { color:var(--acc); }
.ch-row-meta { font-size:10px; color:var(--muted); letter-spacing:0.03em; }

.ch-row-right { display:flex; flex-direction:column; align-items:flex-end; gap:4px; flex-shrink:0; }
.ch-row-num {
  font-family:'Bebas Neue',sans-serif; font-size:11px; letter-spacing:0.1em; color:var(--muted);
}
.ch-row.active .ch-row-num { color:var(--acc); }
.ch-row-live {
  display:flex; align-items:center; gap:3px;
  font-size:7px; letter-spacing:0.14em; text-transform:uppercase;
  color:var(--acc2); background:rgba(212,43,43,0.07);
  border:1px solid rgba(212,43,43,0.18); border-radius:50px; padding:2px 6px;
}
.ch-row-live-dot { width:3px; height:3px; border-radius:50%; background:var(--acc2); animation:pulse 1.6s ease-in-out infinite; }

.now-playing-strip {
  display:none; align-items:center; gap:4px;
  font-size:8px; letter-spacing:0.1em; text-transform:uppercase;
  color:var(--acc); background:rgba(26,140,53,0.08);
  border:1px solid rgba(26,140,53,0.2); border-radius:50px; padding:2px 7px;
}
.ch-row.active .now-playing-strip { display:flex; }
.now-playing-dot { width:3px; height:3px; border-radius:50%; background:var(--acc); animation:pulse 1.6s ease-in-out infinite; }

/* ‚ïê‚ïê TOAST ‚ïê‚ïê */
.toast {
  position:fixed; bottom:28px; left:50%;
  transform:translateX(-50%) translateY(16px);
  background:var(--txt); color:var(--bg);
  border-radius:50px; padding:10px 20px;
  font-size:12px; font-weight:400; letter-spacing:0.06em;
  z-index:200; pointer-events:none; opacity:0;
  transition:all 0.3s cubic-bezier(0.4,0,0.2,1);
  white-space:nowrap; box-shadow:0 8px 32px rgba(0,0,0,0.15);
}
.toast.show { opacity:1; transform:translateX(-50%) translateY(0); }

/* ‚ïê‚ïê RESPONSIVE ‚ïê‚ïê */

/* Large desktop: wider sidebar */
@media (min-width:1400px) {
  .live-layout { grid-template-columns:1fr 380px; }
}

/* Small desktop / large tablet: collapse sidebar below */
@media (max-width:1024px) {
  .live-layout {
    display:block;
  }
  .channels-section {
    margin-top:24px;
    border-radius:14px;
  }
  .ch-list { max-height:none; }
  /* Switch back to grid layout for channels on tablet */
  .ch-list { display:grid; grid-template-columns:repeat(3,1fr); }
  .ch-row { border-bottom:none; border-right:1px solid var(--bdr); }
  .ch-row:nth-child(3n) { border-right:none; }
  .ch-row { flex-direction:column; align-items:flex-start; padding:14px 14px 12px; gap:8px; }
  .ch-row-right { flex-direction:row; align-items:center; width:100%; justify-content:space-between; }
  .ch-row-active-bar { left:0; top:0; right:0; bottom:auto; width:auto; height:3px; transform:scaleX(0); transform-origin:left; }
  .ch-row.active .ch-row-active-bar { transform:scaleX(1); }
  .ch-row-art { width:100%; height:60px; border-radius:8px; }
  .ch-list-head { border-radius:0; }
}

@media (max-width:768px) {
  .wrap { padding:18px 14px 48px; }
  .header-inner { padding:0 16px; }
  .ch-list { grid-template-columns:repeat(2,1fr); }
  .ch-row:nth-child(3n) { border-right:1px solid var(--bdr); }
  .ch-row:nth-child(2n) { border-right:none; }
  .vol-sl { width:52px; }
  .player-infobar { padding:10px 14px; gap:9px; }
  .infobar-qual { display:none; }
}

@media (max-width:480px) {
  .ch-list { grid-template-columns:repeat(2,1fr); }
  .vol-wrap { display:none; }
  .live-layout .sdiv-row { display:none; }
}
</style>
</head>
<body>

<!-- ‚ïê‚ïê HEADER ‚ïê‚ïê -->
<header>
  <div class="header-inner">
    <div class="eyebrow-wrap">
      <div class="eyebrow">Live Streaming</div>
      <div class="brand">PRISM<span>TV</span></div>
    </div>
    <div class="h-spacer"></div>
    <div class="live-pill"><span class="live-dot"></span>ON AIR</div>
  </div>
</header>

<div class="wrap">
  <div class="live-layout">

    <!-- ‚ïê‚ïê PLAYER SECTION ‚ïê‚ïê -->
    <div class="player-section">
      <div class="sdiv">Now Playing <span class="sdiv-badge">DASH ¬∑ ClearKey DRM</span></div>

      <div class="player-card">
        <div class="video-wrap" id="vw">
          <video id="vid" playsinline></video>
          <div class="vg-bot"></div>

          <!-- State overlay -->
          <div class="ps-overlay" id="pso">
            <div class="ps-idle-icon">
              <svg width="28" height="28" viewBox="0 0 24 24" fill="rgba(255,255,255,0.65)"><path d="M8 5v14l11-7z"/></svg>
            </div>
            <div class="ps-idle-title">Select a Channel</div>
            <div class="ps-idle-sub">Choose from the list ‚Üí</div>
          </div>

          <!-- Controls -->
          <div class="ctrl-wrap" id="ctrl-wrap">
            <!-- Progress bar (live = always full, decorative) -->
            <div class="prog-area">
              <div class="prog-track">
                <div class="prog-fill"></div>
                <div class="prog-live-dot"></div>
              </div>
            </div>

            <div class="ctrl-bar">
              <!-- LIVE edge button ‚Äî leftmost -->
              <button class="live-edge-btn at-live" id="live-edge-btn" onclick="goToLiveEdge()" title="Jump to live">
                <span class="live-edge-dot"></span>LIVE
              </button>

              <!-- Play/Pause -->
              <button class="cbtn" onclick="togglePlay()" title="Play / Pause (Space)">
                <svg id="play-icon" width="22" height="22" viewBox="0 0 24 24" fill="currentColor"><path d="M8 5v14l11-7z"/></svg>
              </button>

              <!-- Volume -->
              <div class="vol-wrap">
                <button class="cbtn" onclick="toggleMute()" title="Mute (M)">
                  <svg id="mute-icon" width="18" height="18" viewBox="0 0 24 24" fill="currentColor"><path d="M3 9v6h4l5 5V4L7 9H3zm13.5 3c0-1.77-1.02-3.29-2.5-4.03v8.05c1.48-.73 2.5-2.25 2.5-4.02zM14 3.23v2.06c2.89.86 5 3.54 5 6.71s-2.11 5.85-5 6.71v2.06c4.01-.91 7-4.49 7-8.77s-2.99-7.86-7-8.77z"/></svg>
                </button>
                <input class="vol-sl" id="vol" type="range" min="0" max="1" step="0.02" value="1" oninput="setVol(this.value)" title="Volume">
              </div>

              <div class="c-spacer"></div>

              <!-- Quality picker -->
              <div class="qual-wrap" id="qual-wrap">
                <button class="qual-btn" id="qual-btn" onclick="toggleQualPanel(event)" title="Quality">
                  <span id="qual-label">AUTO</span>
                  <svg viewBox="0 0 24 24" fill="currentColor"><path d="M7 10l5 5 5-5z"/></svg>
                </button>
                <div class="qual-panel" id="qual-panel">
                  <div class="qual-panel-head">
                    Quality
                    <span id="qual-head-badge" style="color:var(--acc)">AUTO</span>
                  </div>
                  <div id="qual-rows"></div>
                </div>
              </div>

              <!-- PiP -->
              <button class="cbtn" id="pip-btn" onclick="togglePiP()" title="Picture in Picture (P)">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor"><path d="M19 7h-8v6h8V7zm2-4H3C1.9 3 1 3.9 1 5v14c0 1.1.9 2 2 2h18c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 16H3V5h18v14z"/></svg>
              </button>

              <!-- Fullscreen -->
              <button class="cbtn" onclick="toggleFS()" title="Fullscreen (F)">
                <svg id="fs-icon" width="18" height="18" viewBox="0 0 24 24" fill="currentColor"><path d="M7 14H5v5h5v-2H7v-3zm-2-4h2V7h3V5H5v5zm12 7h-3v2h5v-5h-2v3zM14 5v2h3v3h2V5h-5z"/></svg>
              </button>
            </div>
          </div>
        </div>

        <!-- Info bar -->
        <div class="player-infobar">
          <span class="infobar-ch" id="ib-ch">Select a channel</span>
          <div class="infobar-sep"></div>
          <span class="infobar-tag live">‚óè LIVE</span>
          <span class="infobar-tag dash">DASH</span>
          <div class="infobar-spacer"></div>
          <span class="infobar-qual" id="ib-qual">‚Äî</span>
        </div>
      </div>
    </div>

    <!-- ‚ïê‚ïê CHANNELS SIDEBAR ‚ïê‚ïê -->
    <div class="channels-section">
      <div class="ch-list-head">
        <span class="ch-list-title">Channels</span>
        <span class="ch-list-count" id="ch-count">8 LIVE</span>
      </div>
      <div class="ch-list" id="ch-list"></div>
    </div>

    <!-- sdiv below player on desktop (hidden on mobile) -->
    <div class="sdiv-row">
      <div class="sdiv" style="margin-bottom:0">Live TV <span class="sdiv-badge">DASH ¬∑ ClearKey DRM ¬∑ Shaka Player</span></div>
    </div>

  </div>
</div>

<div class="toast" id="toast"></div>

<script>
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  CHANNEL CONFIG  ‚Äî replace manifest/keys per channel
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
const CHANNELS = [
  { id:1, name:'Cric Life 2', tag:'Sports ¬∑ HD',   emoji:'üèè', bg:'#d1fae5',
    manifest:'https://ev-fast-mpd.starzplayarabia.com/live/eds/CricLife2/DASH/CricLife2.mpd',
    keys:{'48bef83b4c6a3c5189b01b0126210da4':'bd085230b7b09e50954fe0af111a8a9f'} },
  { id:2, name:'Channel 2',   tag:'Entertainment', emoji:'üé¨', bg:'#fce7f3',
    manifest:'https://ev-fast-mpd.starzplayarabia.com/live/eds/CricLife2/DASH/CricLife2.mpd',
    keys:{'48bef83b4c6a3c5189b01b0126210da4':'bd085230b7b09e50954fe0af111a8a9f'} },
  { id:3, name:'Channel 3',   tag:'News ¬∑ Live',   emoji:'üì°', bg:'#fef3c7',
    manifest:'https://ev-fast-mpd.starzplayarabia.com/live/eds/CricLife2/DASH/CricLife2.mpd',
    keys:{'48bef83b4c6a3c5189b01b0126210da4':'bd085230b7b09e50954fe0af111a8a9f'} },
  { id:4, name:'Channel 4',   tag:'Sports ¬∑ Live', emoji:'‚öΩ', bg:'#dcfce7',
    manifest:'https://ev-fast-mpd.starzplayarabia.com/live/eds/CricLife2/DASH/CricLife2.mpd',
    keys:{'48bef83b4c6a3c5189b01b0126210da4':'bd085230b7b09e50954fe0af111a8a9f'} },
  { id:5, name:'Channel 5',   tag:'Movies ¬∑ HD',   emoji:'üé•', bg:'#ede9fe',
    manifest:'https://ev-fast-mpd.starzplayarabia.com/live/eds/CricLife2/DASH/CricLife2.mpd',
    keys:{'48bef83b4c6a3c5189b01b0126210da4':'bd085230b7b09e50954fe0af111a8a9f'} },
  { id:6, name:'Channel 6',   tag:'Music ¬∑ Live',  emoji:'üéµ', bg:'#fff1f2',
    manifest:'https://ev-fast-mpd.starzplayarabia.com/live/eds/CricLife2/DASH/CricLife2.mpd',
    keys:{'48bef83b4c6a3c5189b01b0126210da4':'bd085230b7b09e50954fe0af111a8a9f'} },
  { id:7, name:'Channel 7',   tag:'Kids ¬∑ HD',     emoji:'üß∏', bg:'#fff7ed',
    manifest:'https://ev-fast-mpd.starzplayarabia.com/live/eds/CricLife2/DASH/CricLife2.mpd',
    keys:{'48bef83b4c6a3c5189b01b0126210da4':'bd085230b7b09e50954fe0af111a8a9f'} },
  { id:8, name:'Channel 8',   tag:'Documentary',   emoji:'üåç', bg:'#f0fdf4',
    manifest:'https://ev-fast-mpd.starzplayarabia.com/live/eds/CricLife2/DASH/CricLife2.mpd',
    keys:{'48bef83b4c6a3c5189b01b0126210da4':'bd085230b7b09e50954fe0af111a8a9f'} }
];

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  STATE
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
let shakaPlayer = null;
let activeCh    = null;
let qualIsAuto  = true;
let qualLockId  = null;

const vid = document.getElementById('vid');
const vw  = document.getElementById('vw');

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  BUILD CHANNEL LIST
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function buildList() {
  const list = document.getElementById('ch-list');
  CHANNELS.forEach(ch => {
    const el = document.createElement('div');
    el.className = 'ch-row';
    el.id = 'row-' + ch.id;
    el.innerHTML = `
      <div class="ch-row-active-bar"></div>
      <div class="ch-row-art" style="background:${ch.bg}">${ch.emoji}</div>
      <div class="ch-row-info">
        <div class="ch-row-name">${ch.name}</div>
        <div class="ch-row-meta">${ch.tag}</div>
        <div class="now-playing-strip" id="np-${ch.id}">
          <span class="now-playing-dot"></span>Now Playing
        </div>
      </div>
      <div class="ch-row-right">
        <span class="ch-row-num">CH&nbsp;${String(ch.id).padStart(2,'0')}</span>
        <div class="ch-row-live"><span class="ch-row-live-dot"></span>LIVE</div>
      </div>`;
    el.onclick = () => loadChannel(ch);
    list.appendChild(el);
  });
}

function markActive(ch) {
  document.querySelectorAll('.ch-row').forEach(e => e.classList.remove('active'));
  document.querySelectorAll('[id^="np-"]').forEach(e => e.style.display = 'none');
  const row = document.getElementById('row-' + ch.id);
  if (row) { row.classList.add('active'); row.scrollIntoView({ behavior:'smooth', block:'nearest' }); }
  const np = document.getElementById('np-' + ch.id);
  if (np) np.style.display = 'flex';
  document.getElementById('ib-ch').textContent = ch.name;
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  LOAD CHANNEL
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
async function loadChannel(ch) {
  if (activeCh && activeCh.id === ch.id) return;
  activeCh   = ch;
  qualIsAuto = true;
  qualLockId = null;

  markActive(ch);
  showPSO('loading', 'Loading ' + ch.name + '‚Ä¶');
  setQualBtn('AUTO', false);
  clearQualRows();
  document.getElementById('ib-qual').textContent = '‚Äî';
  setLiveBtnState(true);

  try {
    if (shakaPlayer) { await shakaPlayer.destroy(); shakaPlayer = null; }
    shaka.polyfill.installAll();
    if (!shaka.Player.isBrowserSupported()) {
      showPSO('error', 'Browser does not support DASH/EME.'); return;
    }

    shakaPlayer = new shaka.Player(vid);

    shakaPlayer.addEventListener('error', e => {
      console.error('Shaka error:', e.detail);
      showPSO('error', 'Stream error ' + e.detail.code + '\n' + (e.detail.message || 'Check network.'));
    });
    shakaPlayer.addEventListener('buffering', e => {
      if (e.buffering) showPSO('loading', 'Buffering‚Ä¶');
      else showPSO('hide');
    });
    shakaPlayer.addEventListener('adaptation', () => {
      if (qualIsAuto) refreshQualDisplay();
      rebuildQualRows();
    });

    const cfg = {
      abr: { enabled: true },
      streaming: {
        bufferingGoal: 12, rebufferingGoal: 2, bufferBehind: 30,
        retryParameters: { maxAttempts: 6, baseDelay: 1000, backoffFactor: 2, fuzzFactor: 0.5 }
      }
    };
    if (ch.keys && Object.keys(ch.keys).length) cfg.drm = { clearKeys: ch.keys };
    shakaPlayer.configure(cfg);

    await shakaPlayer.load(ch.manifest);
    vid.play();
    showPSO('hide');
    rebuildQualRows();
    refreshQualDisplay();
    toast('‚ñ∂  ' + ch.name);

  } catch(e) {
    console.error('Load error:', e);
    showPSO('error', 'Could not load stream.\n' + (e.message || 'Unknown error'));
  }
}

function loadChannelById(id) {
  const ch = CHANNELS.find(c => c.id === id);
  if (ch) loadChannel(ch);
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  LIVE EDGE BUTTON
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function goToLiveEdge() {
  if (!shakaPlayer) return;
  try {
    // For live streams: seek to the live edge
    const liveTime = shakaPlayer.seekRange().end;
    if (liveTime && isFinite(liveTime)) vid.currentTime = liveTime;
    else vid.currentTime = vid.duration || vid.currentTime;
    if (vid.paused) vid.play();
    setLiveBtnState(true);
    toast('‚¨§ Back to Live');
  } catch(e) { console.warn('seekToLive:', e); }
}

function setLiveBtnState(isLive) {
  const btn = document.getElementById('live-edge-btn');
  if (isLive) btn.classList.add('at-live');
  else btn.classList.remove('at-live');
}

// Track if user drifts from live
vid.addEventListener('seeking', () => {
  if (!shakaPlayer) return;
  try {
    const range = shakaPlayer.seekRange();
    const diff  = range.end - vid.currentTime;
    setLiveBtnState(diff < 8); // within 8s = still "live"
  } catch(e) {}
});
vid.addEventListener('timeupdate', () => {
  if (!shakaPlayer) return;
  try {
    const range = shakaPlayer.seekRange();
    const diff  = range.end - vid.currentTime;
    setLiveBtnState(diff < 8);
  } catch(e) {}
});

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  QUALITY PICKER
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function fmtBw(bps) {
  if (!bps) return '';
  return bps >= 1_000_000
    ? (bps / 1_000_000).toFixed(1) + ' Mbps'
    : Math.round(bps / 1000) + ' kbps';
}

function getUniqueVideoTracks() {
  if (!shakaPlayer) return [];
  const map = new Map();
  shakaPlayer.getVariantTracks().forEach(t => {
    const fps = t.frameRate ? Math.round(t.frameRate) : 0;
    const key = (t.height || 0) + '_' + fps;
    if (!map.has(key) || t.bandwidth > map.get(key).bandwidth) map.set(key, t);
  });
  return Array.from(map.values()).sort((a, b) => {
    const h = (b.height||0) - (a.height||0);
    return h !== 0 ? h : (Math.round(b.frameRate)||0) - (Math.round(a.frameRate)||0);
  });
}

function getActiveTrack() {
  if (!shakaPlayer) return null;
  return shakaPlayer.getVariantTracks().find(t => t.active) || null;
}

function setQualBtn(label, isHD) {
  document.getElementById('qual-label').textContent = label;
  document.getElementById('qual-btn').className = 'qual-btn' + (isHD ? ' hd' : '');
}
function clearQualRows() { document.getElementById('qual-rows').innerHTML = ''; }

function refreshQualDisplay() {
  const t = getActiveTrack();
  if (!t) return;
  const fps   = t.frameRate ? Math.round(t.frameRate) : null;
  const res   = t.height ? t.height + 'p' : 'SD';
  const label = fps ? res + ' ' + fps + 'fps' : res;
  const isHD  = (t.height||0) >= 720;
  setQualBtn(label, isHD);
  document.getElementById('ib-qual').textContent = label;
  document.getElementById('ib-qual').className   = 'infobar-qual' + (isHD ? ' hd' : '');
  document.getElementById('qual-head-badge').textContent = qualIsAuto ? 'AUTO' : 'MANUAL';
}

function rebuildQualRows() {
  if (!shakaPlayer) return;
  const unique    = getUniqueVideoTracks();
  const active    = getActiveTrack();
  const container = document.getElementById('qual-rows');
  container.innerHTML = '';

  // Auto row
  const autoRow = document.createElement('div');
  autoRow.className = 'qrow-auto' + (qualIsAuto ? ' sel' : '');
  autoRow.innerHTML = `
    <div class="qrow-auto-left">
      <div class="qrow-auto-label">Auto</div>
      <div class="qrow-auto-sub">Matches your connection speed</div>
    </div>
    <div class="qrow-check">
      <svg width="9" height="9" viewBox="0 0 24 24" fill="white"><path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/></svg>
    </div>`;
  autoRow.onclick = () => selectAuto();
  container.appendChild(autoRow);

  // Track rows
  unique.forEach(t => {
    const fps   = t.frameRate ? Math.round(t.frameRate) : null;
    const res   = (t.height || 0) ? t.height + 'p' : 'SD';
    const isSel = !qualIsAuto && qualLockId === t.id;
    const isCur = qualIsAuto && active && active.id === t.id;
    const row   = document.createElement('div');
    row.className = 'qrow' + (isSel ? ' sel' : '');
    row.innerHTML = `
      <span class="qrow-res">${res}</span>
      ${fps ? `<span class="qrow-fps">${fps} fps</span>` : ''}
      ${isCur && !isSel ? `<span class="qrow-fps" style="color:var(--acc);border-color:rgba(26,140,53,.3);background:rgba(26,140,53,.07)">‚ñ∂ now</span>` : ''}
      <span class="qrow-bw">${fmtBw(t.bandwidth)}</span>
      <div class="qrow-check">
        <svg width="9" height="9" viewBox="0 0 24 24" fill="white"><path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/></svg>
      </div>`;
    row.onclick = () => selectTrack(t);
    container.appendChild(row);
  });
}

function selectAuto() {
  if (!shakaPlayer) return;
  qualIsAuto = true; qualLockId = null;
  shakaPlayer.configure({ abr:{ enabled:true } });
  rebuildQualRows(); refreshQualDisplay(); closeQualPanel();
  toast('Quality: Auto');
}
function selectTrack(track) {
  if (!shakaPlayer) return;
  qualIsAuto = false; qualLockId = track.id;
  shakaPlayer.configure({ abr:{ enabled:false } });
  shakaPlayer.selectVariantTrack(track, true);
  const fps   = track.frameRate ? Math.round(track.frameRate) : null;
  const label = (track.height ? track.height + 'p' : 'SD') + (fps ? ' ' + fps + 'fps' : '');
  setQualBtn(label, (track.height||0) >= 720);
  document.getElementById('ib-qual').textContent = label;
  document.getElementById('ib-qual').className   = 'infobar-qual' + ((track.height||0) >= 720 ? ' hd' : '');
  document.getElementById('qual-head-badge').textContent = 'MANUAL';
  rebuildQualRows(); closeQualPanel();
  toast('Quality: ' + label);
}
function toggleQualPanel(e) {
  e.stopPropagation();
  const p = document.getElementById('qual-panel');
  if (p.classList.contains('open')) closeQualPanel();
  else { rebuildQualRows(); p.classList.add('open'); }
}
function closeQualPanel() { document.getElementById('qual-panel').classList.remove('open'); }
document.addEventListener('click', e => { if (!e.target.closest('#qual-wrap')) closeQualPanel(); });

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  PICTURE-IN-PICTURE
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
async function togglePiP() {
  try {
    if (document.pictureInPictureElement) {
      await document.exitPictureInPicture();
    } else if (document.pictureInPictureEnabled && vid.readyState >= 2) {
      await vid.requestPictureInPicture();
      toast('‚ßâ  Picture in Picture');
    } else {
      toast('PiP not supported or no stream loaded');
    }
  } catch(e) {
    console.warn('PiP error:', e);
    toast('PiP unavailable');
  }
}

// Update PiP button icon when entering/leaving PiP
vid.addEventListener('enterpictureinpicture', () => {
  document.getElementById('pip-btn').style.color = 'rgba(26,180,80,0.9)';
});
vid.addEventListener('leavepictureinpicture', () => {
  document.getElementById('pip-btn').style.color = '';
});

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  PLAYER STATE OVERLAY
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function showPSO(type, msg) {
  const el = document.getElementById('pso');
  if (type === 'hide') { el.classList.add('gone'); return; }
  el.classList.remove('gone');
  if (type === 'loading') {
    el.innerHTML = `<div class="ps-spinner"></div><div class="ps-txt">${msg || 'Loading‚Ä¶'}</div>`;
  } else if (type === 'error') {
    el.innerHTML = `
      <div class="ps-err-icon">‚ö†Ô∏è</div>
      <div class="ps-err-title">Stream Unavailable</div>
      <div class="ps-err-msg">${msg || ''}</div>
      <button class="ps-retry" onclick="retryChannel()">‚Ü∫  Retry</button>`;
  }
}
function retryChannel() { if (activeCh) { const c = activeCh; activeCh = null; loadChannel(c); } }

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  PLAYBACK CONTROLS
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function togglePlay() { if (vid.paused) vid.play(); else vid.pause(); }

vid.addEventListener('play', () => {
  document.getElementById('play-icon').innerHTML = '<path d="M6 19h4V5H6v14zm8-14v14h4V5h-4z"/>';
  vw.classList.remove('paused');
});
vid.addEventListener('pause', () => {
  document.getElementById('play-icon').innerHTML = '<path d="M8 5v14l11-7z"/>';
  vw.classList.add('paused');
});

function setVol(v) { vid.volume = parseFloat(v); syncMuteIcon(); }
function toggleMute() { vid.muted = !vid.muted; syncMuteIcon(); }
function syncMuteIcon() {
  document.getElementById('mute-icon').innerHTML = (vid.muted || vid.volume === 0)
    ? '<path d="M16.5 12c0-1.77-1.02-3.29-2.5-4.03v2.21l2.45 2.45c.03-.2.05-.41.05-.63zm2.5 0c0 .94-.2 1.82-.54 2.64l1.51 1.51C20.63 14.91 21 13.5 21 12c0-4.28-2.99-7.86-7-8.77v2.06c2.89.86 5 3.54 5 6.71zM4.27 3L3 4.27 7.73 9H3v6h4l5 5v-6.73l4.25 4.25c-.67.52-1.42.93-2.25 1.18v2.06c1.38-.31 2.63-.95 3.69-1.81L19.73 21 21 19.73l-9-9L4.27 3zM12 4L9.91 6.09 12 8.18V4z"/>'
    : '<path d="M3 9v6h4l5 5V4L7 9H3zm13.5 3c0-1.77-1.02-3.29-2.5-4.03v8.05c1.48-.73 2.5-2.25 2.5-4.02zM14 3.23v2.06c2.89.86 5 3.54 5 6.71s-2.11 5.85-5 6.71v2.06c4.01-.91 7-4.49 7-8.77s-2.99-7.86-7-8.77z"/>';
}

function toggleFS() {
  if (!document.fullscreenElement) {
    vw.requestFullscreen && vw.requestFullscreen();
    document.getElementById('fs-icon').innerHTML = '<path d="M5 16h3v3h2v-5H5v2zm3-8H5v2h5V5H8v3zm6 11h2v-3h3v-2h-5v5zm2-11V5h-2v5h5V8h-3z"/>';
  } else {
    document.exitFullscreen && document.exitFullscreen();
    document.getElementById('fs-icon').innerHTML = '<path d="M7 14H5v5h5v-2H7v-3zm-2-4h2V7h3V5H5v5zm12 7h-3v2h5v-5h-2v3zM14 5v2h3v3h2V5h-5z"/>';
  }
}
document.addEventListener('fullscreenchange', () => {
  if (!document.fullscreenElement)
    document.getElementById('fs-icon').innerHTML = '<path d="M7 14H5v5h5v-2H7v-3zm-2-4h2V7h3V5H5v5zm12 7h-3v2h5v-5h-2v3zM14 5v2h3v3h2V5h-5z"/>';
});

// Auto-hide controls
let ctrlTimer;
vw.addEventListener('mousemove', () => {
  vw.classList.add('show-ctrl');
  clearTimeout(ctrlTimer);
  ctrlTimer = setTimeout(() => vw.classList.remove('show-ctrl'), 3200);
});
vw.addEventListener('mouseleave', () => {
  clearTimeout(ctrlTimer);
  ctrlTimer = setTimeout(() => vw.classList.remove('show-ctrl'), 800);
});
vw.addEventListener('touchstart', () => vw.classList.toggle('show-ctrl'), { passive:true });
vw.addEventListener('click', e => {
  if (e.target.closest('.cbtn') || e.target.closest('.vol-sl') ||
      e.target.closest('#qual-wrap') || e.target.closest('.live-edge-btn')) return;
  if (activeCh) togglePlay();
});

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  TOAST
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
let toastT;
function toast(msg) {
  const t = document.getElementById('toast');
  t.textContent = msg; t.classList.add('show');
  clearTimeout(toastT);
  toastT = setTimeout(() => t.classList.remove('show'), 2400);
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  KEYBOARD
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
document.addEventListener('keydown', e => {
  if (e.target.tagName === 'INPUT' || e.target.tagName === 'TEXTAREA') return;
  if (e.code === 'Space')     { e.preventDefault(); if (activeCh) togglePlay(); }
  if (e.code === 'KeyM')      toggleMute();
  if (e.code === 'KeyF')      toggleFS();
  if (e.code === 'KeyP')      togglePiP();
  if (e.code === 'KeyL')      goToLiveEdge();
  if (e.code === 'ArrowUp')   { vid.volume = Math.min(1, vid.volume + 0.1); document.getElementById('vol').value = vid.volume; toast('üîä  ' + Math.round(vid.volume * 100) + '%'); }
  if (e.code === 'ArrowDown') { vid.volume = Math.max(0, vid.volume - 0.1); document.getElementById('vol').value = vid.volume; toast('üîâ  ' + Math.round(vid.volume * 100) + '%'); }
  const n = parseInt(e.key);
  if (n >= 1 && n <= CHANNELS.length) loadChannel(CHANNELS[n - 1]);
});

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  INIT
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
buildList();
</script>
</body>
</html>
